<!DOCTYPE html>
<html lang="en">
<%- include('layouts/header') -%>

    <body>
        <!-- Spinner Start -->
        <div id="spinner"
            class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-grow text-primary" role="status"></div>
        </div>
        <!-- Spinner End -->

        <!-- Topbar Start -->
        <div class="container-fluid bg-dark text-light p-0">
            <div class="row gx-0 d-none d-lg-flex">
                <div class="col-lg-7 px-5 text-start">
                    <div class="h-100 d-inline-flex align-items-center me-4">
                        <small class="fa fa-map-marker-alt text-primary me-2"></small>
                        <small>123 Street, New York, USA</small>
                    </div>
                    <div class="h-100 d-inline-flex align-items-center">
                        <small class="far fa-clock text-primary me-2"></small>
                        <small>Mon - Fri : 09.00 AM - 09.00 PM</small>
                    </div>
                </div>
                <div class="col-lg-5 px-5 text-end">
                    <div class="h-100 d-inline-flex align-items-center me-4">
                        <small class="fa fa-phone-alt text-primary me-2"></small>
                        <small>+012 345 6789</small>
                    </div>
                    <div class="h-100 d-inline-flex align-items-center mx-n2">
                        <a class="btn btn-square btn-link rounded-0 border-0 border-end border-secondary" href=""><i
                                class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-square btn-link rounded-0 border-0 border-end border-secondary" href=""><i
                                class="fab fa-twitter"></i></a>
                        <a class="btn btn-square btn-link rounded-0 border-0 border-end border-secondary" href=""><i
                                class="fab fa-linkedin-in"></i></a>
                        <a class="btn btn-square btn-link rounded-0" href=""><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Topbar End -->

        <!-- Navbar Start -->
        <%- include('layouts/navbar') -%>
            <!-- Navbar End -->

            <!-- G2 Booking Start -->
            <div class="container-xxl py-6">
                <div class="container">
                    <div class="row g-5">
                        <div class="col-lg-6 offset-lg-3 wow fadeInUp" data-wow-delay="0.1s">
                            <h6 class="text-primary text-uppercase mb-2">G2 Test</h6>
                            <h1 class="display-6 mb-4">Book Your G2 Test</h1>
                            <form id="updateProfileForm" action="/user/updateUser" method="post">
                                <div class="row g-3">
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0 bg-light" id="firstname"
                                                name="firstname" placeholder="First Name" required>
                                            <label for="firstname">First Name</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0 bg-light" id="lastname"
                                                name="lastname" placeholder="Last Name" required>
                                            <label for="lastname">Last Name</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0 bg-light" id="licenseNo"
                                                name="licenseNo" placeholder="License Number" pattern="[A-Za-z0-9]{8}"
                                                title="8 characters, alphanumeric" required>
                                            <label for="licenseNo">License Number</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="number" class="form-control border-0 bg-light" id="age"
                                                name="age" placeholder="Age" min="1" max="120" required>
                                            <label for="age">Age</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <h5>Car Details</h5>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0 bg-light" id="carMake"
                                                name="carMake" placeholder="Car Make" required>
                                            <label for="carMake">Car Make</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0 bg-light" id="carModel"
                                                name="carModel" placeholder="Car Model" required>
                                            <label for="carModel">Car Model</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="number" class="form-control border-0 bg-light" id="carYear"
                                                name="carYear" placeholder="Car Year" min="1886" max="2024" required>
                                            <label for="carYear">Car Year</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0 bg-light" id="plateNumber"
                                                name="plateNumber" placeholder="Plate Number" required>
                                            <label for="plateNumber">Plate Number</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="date" class="form-control border-0 bg-light" id="calendar"
                                                name="calendar" placeholder="" required
                                                min="<%= new Date().toISOString().split('T')[0] %>" />
                                            <label for="calendar">choose a day</label>
                                        </div>
                                    </div>

                                    <div class="col-12 text-center">
                                        <button type="submit" id="book-appointment" class="btn btn-primary py-3 px-5">
                                            Book Appointment
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- G2 Booking End -->

            <!-- Footer Start -->
            <%- include('layouts/footer') -%>

                <!-- JavaScript Libraries -->
                <%- include('layouts/script') -%>
                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
                    <script>
                        $(document).ready(function () {
                            let selectedDate = null;
                            let selectedTime = null;

                            $("#calendar").change(function () {
                                selectedDate = $(this).val();
                                fetchAvailableSlots(selectedDate);
                            });

                            function fetchAvailableSlots(date) {
                                $.get(`/g2/slots/${date}`, function (data) {
                                    let slotsContainer = $("#slots-container");
                                    slotsContainer.empty();
                                    data.slots.forEach((slot) => {
                                        if (slot.isTimeSlotAvailable) {
                                            slotsContainer.append(
                                                `<button type="button" class="btn btn-primary m-1" onclick="selectSlot('${slot.time}')">${slot.time}</button>`
                                            );
                                        }
                                    });
                                });
                            }

                            window.selectSlot = function (time) {
                                selectedTime = time;
                                alert(`You have selected ${time} on ${selectedDate}. Click "Book Appointment" to confirm.`);
                            };

                            $("#book-appointment").click(function () {
                                if (selectedDate && selectedTime) {
                                    confirmBooking(selectedDate, selectedTime);
                                } else {
                                    alert("Please select a date and time slot.");
                                }
                            });

                            function confirmBooking(date, time) {
                                if (confirm(`Do you want to book this slot on ${date} at ${time}?`)) {
                                    bookSlot(date, time);
                                }
                            }

                            function bookSlot(date, time) {
                                $.post("/g2/book", { date, time }, function (response) {
                                    if (response.success) {
                                        alert(response.message);
                                        fetchAvailableSlots(date); // Refresh available slots
                                    } else {
                                        alert(response.message);
                                    }
                                });
                            }
                        });
                    </script>
    </body>

</html>